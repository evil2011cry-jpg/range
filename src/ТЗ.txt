# üìã –ü–û–õ–ù–ê–Ø –î–û–ö–£–ú–ï–ù–¢–ê–¶–ò–Ø –°–ò–°–¢–ï–ú–´ –í–ò–î–ï–û–ö–û–ù–§–ï–†–ï–ù–¶–ò–ò v2

**–î–ª—è –±—É–¥—É—â–∏—Ö —á–∞—Ç–æ–≤: –ø—Ä–æ—á–∏—Ç–∞–π —ç—Ç–æ –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø–µ—Ä–µ–¥ –ª—é–±—ã–º–∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è–º–∏!**

---

## üéØ –û–ë–©–ò–ô –û–ë–ó–û–† –°–ò–°–¢–ï–ú–´

### –ß—Ç–æ —ç—Ç–æ:
Vue 3 –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —É—á–∞—Å—Ç–Ω–∏–∫–∞–º–∏ –≤–∏–¥–µ–æ–∫–æ–Ω—Ñ–µ—Ä–µ–Ω—Ü–∏–∏ —Å –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–º —Ä–∞–Ω–∂–∏—Ä–æ–≤–∞–Ω–∏–µ–º, –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π –∏ –∞–ª–≥–æ—Ä–∏—Ç–º–æ–º —Å—Ç–∞–±–∏–ª—å–Ω–æ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è (survivors/newcomers).

### –ö–ª—é—á–µ–≤–∞—è –∫–æ–Ω—Ü–µ–ø—Ü–∏—è:
**"–í –ö–û–ù–¢–ï–ö–°–¢–ï"** - —É—á–∞—Å—Ç–Ω–∏–∫ –≤—ã—Ç–µ—Å–Ω—è–µ—Ç—Å—è —Å–æ —Å—Ü–µ–Ω—ã –¢–û–õ–¨–ö–û –µ—Å–ª–∏ –µ—Å—Ç—å –∫—Ç–æ-—Ç–æ –°–ò–õ–¨–ù–ï–ï –∑–∞ –ø—Ä–µ–¥–µ–ª–∞–º–∏ —Å—Ü–µ–Ω—ã. –ù–µ –ø—Ä–æ—Å—Ç–æ —Ç–∞–∫, –Ω–µ –ø–æ —Ç–∞–π–º–µ—Ä—É, –∞ —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —Ä–µ–∞–ª—å–Ω–æ –µ—Å—Ç—å –∑–∞–º–µ–Ω–∞.

### –û—Å–Ω–æ–≤–Ω—ã–µ —Å—É—â–Ω–æ—Å—Ç–∏:
- **Stage** (—Å—Ü–µ–Ω–∞) - —Ç–æ–ø-11 —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –Ω–∞ –ø–µ—Ä–≤–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ
- **OffStage** - –æ—Å—Ç–∞–ª—å–Ω—ã–µ —É—á–∞—Å—Ç–Ω–∏–∫–∏ –Ω–∞ –ø–æ—Å–ª–µ–¥—É—é—â–∏—Ö —Å—Ç—Ä–∞–Ω–∏—Ü–∞—Ö
- **participantsOrder** - –≥–ª–æ–±–∞–ª—å–Ω—ã–π –ª–∏–Ω–µ–π–Ω—ã–π —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ (–ø–æ—Ä—è–¥–æ–∫ –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è)
- **Grace period** - 2-—Å–µ–∫—É–Ω–¥–Ω–∞—è –∑–∞—â–∏—Ç–∞ –ø—Ä–∏ –≤—ã–∫–ª—é—á–µ–Ω–∏–∏ –º–∏–∫—Ä–æ—Ñ–æ–Ω–∞
- **Survivors/Newcomers** - –∞–ª–≥–æ—Ä–∏—Ç–º —Å—Ç–∞–±–∏–ª—å–Ω–æ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è (–∫—Ç–æ —É–∂–µ –±—ã–ª / –∫—Ç–æ –ø—Ä–∏—à–µ–ª –Ω–æ–≤—ã–π)

---

## üìä –ê–†–•–ò–¢–ï–ö–¢–£–†–ê –î–ê–ù–ù–´–•

### participants: {}
```javascript
{
  'user_1': { id, name, mic: boolean, cam: boolean, pinned: boolean },
  'user_2': { ... }
}
```

### participantsOrder: []
```javascript
['user_1', 'user_3', 'user_2', ...]
```
**–ö–†–ò–¢–ò–ß–ù–û:** –ü–æ—Ä—è–¥–æ–∫ = –ø–æ—Ä—è–¥–æ–∫ –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è (join order)  
**–ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞:** –°–Ω–∞—á–∞–ª–∞ –í–°–ï —Å –∫–∞–º–µ—Ä–∞–º–∏, –ø–æ—Ç–æ–º –í–°–ï –±–µ–∑ –∫–∞–º–µ—Ä

### stage: []
```javascript
['user_5', 'user_1', 'user_3', ...] // –ú–∞–∫—Å–∏–º—É–º 11 ID
```
**–ü–æ—Ä—è–¥–æ–∫:** –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –∞–ª–≥–æ—Ä–∏—Ç–º–æ–º survivors/newcomers

### gracePeriodTimers: {}
```javascript
{
  'user_7': timeoutId,  // setTimeout –Ω–∞ 2000ms
}
```

---

## üèÜ –ü–†–ò–û–†–ò–¢–ï–¢–´ (getPriority)

```javascript
4 = mic + cam    // –ì–æ–≤–æ—Ä–∏—Ç —Å –∫–∞–º–µ—Ä–æ–π (—Å–∏–ª—å–Ω–µ–π—à–∏–π)
3 = mic –±–µ–∑ cam  // –ì–æ–≤–æ—Ä–∏—Ç –±–µ–∑ –∫–∞–º–µ—Ä—ã
2 = cam –±–µ–∑ mic  // –ú–æ–ª—á–∏—Ç —Å –∫–∞–º–µ—Ä–æ–π
1 = –Ω–∏ —Ç–æ –Ω–∏ —Å–µ  // –ú–æ–ª—á–∏—Ç –±–µ–∑ –∫–∞–º–µ—Ä—ã (—Å–ª–∞–±–µ–π—à–∏–π)
0 = undefined    // –£—á–∞—Å—Ç–Ω–∏–∫ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç (–∑–∞—â–∏—Ç–∞)
```

**–í–ê–ñ–ù–û:** getPriority –ù–ï –î–û–õ–ñ–ï–ù —É—á–∏—Ç—ã–≤–∞—Ç—å gracePeriodTimers!  
–ú—ã —ç—Ç–æ –ø—Ä–æ–±–æ–≤–∞–ª–∏ 5 —Ä–∞–∑ - –ª–æ–º–∞–µ—Ç –∫–æ–Ω—Ü–µ–ø—Ü–∏—é "–≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ".

---

## üî• –ê–õ–ì–û–†–ò–¢–ú updateStageImmediate (–°–ï–†–î–¶–ï –°–ò–°–¢–ï–ú–´)

### –ó–∞–¥–∞—á–∏:
1. **–°–û–°–¢–ê–í stage** - –∫—Ç–æ –≤—Ö–æ–¥–∏—Ç –≤ —Ç–æ–ø-11
2. **–ü–û–†–Ø–î–û–ö stage** - –∫—Ç–æ –≥–¥–µ —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω (–¥–ª—è —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏ UX)

### –ü–æ—à–∞–≥–æ–≤—ã–π –∞–ª–≥–æ—Ä–∏—Ç–º:

#### –®–∞–≥ 1: –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –∂–∏–≤—ã—Ö
```javascript
const aliveOrder = this.participantsOrder.filter(id => !!this.participants[id]);
```

#### –®–∞–≥ 2: –†–∞–Ω–Ω—è—è –ø—Ä–æ–≤–µ—Ä–∫–∞
```javascript
if (aliveOrder.length <= 11) {
  this.stage = [];  // Stage –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è
  return;
}
```

#### –®–∞–≥ 3: –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤
```javascript
const currentStageAlive = this.stage.filter(id => !!this.participants[id]);
const uniqueCandidates = Array.from(new Set([...currentStageAlive, ...aliveOrder]));
```
**–õ–æ–≥–∏–∫–∞:** –î–∞–µ–º —à–∞–Ω—Å –∏ —Ç–µ–∫—É—â–∏–º –∏ –Ω–æ–≤—ã–º

#### –®–∞–≥ 4: –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ —Å–∏–ª–µ
```javascript
const sortedByStrength = [...uniqueCandidates].sort((a, b) => {
  return this.getPriority(b) - this.getPriority(a);
});
```
**–¶–µ–ª—å:** –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –¢–û–ü-11 –ø–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞–º

#### –®–∞–≥ 5: –¢–æ–ø-11 –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤
```javascript
const top11 = sortedByStrength.slice(0, 11);
const top11Set = new Set(top11);
```

#### –®–∞–≥ 6: Survivors vs Newcomers (–ö–õ–Æ–ß–ï–í–û–ï!)
```javascript
const survivors = currentStageAlive.filter(id => top11Set.has(id));
const newcomers = top11.filter(id => !survivors.includes(id));
```

**–ü–æ—á–µ–º—É —ç—Ç–æ –≤–∞–∂–Ω–æ:**
- **survivors** = –∫—Ç–æ —É–∂–µ –±—ã–ª –Ω–∞ stage –∏ –æ—Å—Ç–∞–ª—Å—è –≤ —Ç–æ–ø-11
- **newcomers** = –∫—Ç–æ –≤–æ—Ä–≤–∞–ª—Å—è –≤ —Ç–æ–ø-11 –≤–ø–µ—Ä–≤—ã–µ
- **UX:** survivors –ù–ï –ø—Ä—ã–≥–∞—é—Ç, newcomers –∏–¥—É—Ç –ø–æ—Å–ª–µ
- **–†–µ—à–µ–Ω–∏–µ –æ—Ç ChatGPT** - –ø—Ä–æ–≤–µ—Ä–µ–Ω–æ, —Ä–∞–±–æ—Ç–∞–µ—Ç –æ—Ç–ª–∏—á–Ω–æ!

#### –®–∞–≥ 7: –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ –∫–∞–º–µ—Ä–∞–º
```javascript
const camSurvivors = survivors.filter(id => this.participants[id]?.cam);
const camNew = newcomers.filter(id => this.participants[id]?.cam);
const noCamSurvivors = survivors.filter(id => !this.participants[id]?.cam);
const noCamNew = newcomers.filter(id => !this.participants[id]?.cam);
```

#### –®–∞–≥ 8: –§–∏–Ω–∞–ª—å–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫
```javascript
this.stage = [
  ...camSurvivors,    // –ö—Ç–æ —É–∂–µ –±—ã–ª —Å –∫–∞–º–µ—Ä–æ–π (—Å—Ç–∞—Ä—ã–π –ø–æ—Ä—è–¥–æ–∫)
  ...camNew,          // –ù–æ–≤–∏—á–∫–∏ —Å –∫–∞–º–µ—Ä–æ–π
  ...noCamSurvivors,  // –ö—Ç–æ —É–∂–µ –±—ã–ª –±–µ–∑ –∫–∞–º–µ—Ä—ã
  ...noCamNew         // –ù–æ–≤–∏—á–∫–∏ –±–µ–∑ –∫–∞–º–µ—Ä—ã
];
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚úÖ –ö–∞–º–µ—Ä—ã –≤—Å–µ–≥–¥–∞ –≤–ø–µ—Ä–µ–¥–∏
- ‚úÖ Survivors –Ω–µ –ø—Ä—ã–≥–∞—é—Ç –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∞–ø–¥–µ–π—Ç–µ
- ‚úÖ Newcomers –Ω–µ "–≤—Ä—ã–≤–∞—é—Ç—Å—è" –Ω–∞ –ø–µ—Ä–≤—É—é –ø–æ–∑–∏—Ü–∏—é
- ‚úÖ –í–∏–∑—É–∞–ª—å–Ω–æ —Å—Ç–∞–±–∏–ª—å–Ω–∞—è —Å—Ü–µ–Ω–∞
- ‚úÖ –†–µ—à–∞–µ—Ç –±–∞–≥ "user_20 –ø—Ä—ã–≥–∞–µ—Ç –≤ –Ω–∞—á–∞–ª–æ"

---

## ‚è±Ô∏è GRACE PERIOD –õ–û–ì–ò–ö–ê

### –ß—Ç–æ —ç—Ç–æ:
–ü—Ä–∏ –≤—ã–∫–ª—é—á–µ–Ω–∏–∏ –º–∏–∫—Ä–æ—Ñ–æ–Ω–∞ —É—á–∞—Å—Ç–Ω–∏–∫—É –ù–ê stage –¥–∞–µ—Ç—Å—è 2 —Å–µ–∫—É–Ω–¥—ã "–∏–º–º—É–Ω–∏—Ç–µ—Ç–∞" –ø–µ—Ä–µ–¥ –≤–æ–∑–º–æ–∂–Ω—ã–º –≤—ã—Ç–µ—Å–Ω–µ–Ω–∏–µ–º.

### –ê–ª–≥–æ—Ä–∏—Ç–º –≤ toggleMic:

```javascript
else if (!participant.mic && wasOnStage) {
  // –û—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä–æ–≥–æ grace –µ—Å–ª–∏ –±—ã–ª
  if (this.gracePeriodTimers[id]) {
    clearTimeout(this.gracePeriodTimers[id]);
    delete this.gracePeriodTimers[id];
  }

  // –ù–æ–≤—ã–π grace –Ω–∞ 2 —Å–µ–∫
  this.gracePeriodTimers[id] = setTimeout(() => {
    // –ü—Ä–æ–≤–µ—Ä–∫–∞: –µ—Å—Ç—å –ª–∏ –∫—Ç–æ-—Ç–æ –°–ò–õ–¨–ù–ï–ï offStage?
    const myPriority = this.getPriority(id);
    const offStage = this.participantsOrder.filter(otherId => !this.stage.includes(otherId));

    const strongerExists = offStage.some(otherId => {
      return this.getPriority(otherId) > myPriority;  // –°–¢–†–û–ì–û >
    });

    // –í—ã—Ç–µ—Å–Ω—è–µ–º –¢–û–õ–¨–ö–û –µ—Å–ª–∏ –µ—Å—Ç—å —Å–∏–ª—å–Ω–µ–µ
    if (strongerExists) {
      this.updateStage();
    }

    // –°–Ω–∏–º–∞–µ–º grace
    delete this.gracePeriodTimers[id];
  }, 2000);
}
```

### –ö–ª—é—á–µ–≤—ã–µ –º–æ–º–µ–Ω—Ç—ã:
1. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ `>` (—Å—Ç—Ä–æ–≥–æ –±–æ–ª—å—à–µ), –Ω–µ `>=`
2. ‚úÖ –ü—Ä–∏ —Ä–∞–≤–Ω—ã—Ö –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞—Ö –ù–ï –≤—ã—Ç–µ—Å–Ω—è–µ—Ç
3. ‚úÖ updateStage() –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –¢–û–õ–¨–ö–û –µ—Å–ª–∏ strongerExists
4. ‚úÖ delete –ü–û–°–õ–ï –ø—Ä–æ–≤–µ—Ä–∫–∏ (–Ω–µ –¥–æ!)

### –û—Å–æ–∑–Ω–∞–Ω–Ω—ã–π trade-off (–ü–†–û–í–ï–†–ï–ù–û 3 –°–ü–û–°–û–ë–ê–ú–ò):
–ï—Å–ª–∏ –≤–æ –≤—Ä–µ–º—è 2-—Å–µ–∫ grace –∫—Ç–æ-—Ç–æ –≤–∫–ª—é—á–∏—Ç –∫–∞–º–µ—Ä—É ‚Üí updateStage() ‚Üí –¥–æ—Å—Ä–æ—á–Ω–æ–µ –≤—ã—Ç–µ—Å–Ω–µ–Ω–∏–µ –≤–æ–∑–º–æ–∂–Ω–æ.

**–ü–æ—á–µ–º—É –ø—Ä–∏–µ–º–ª–µ–º–æ:**
- –í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –∫—Ä–∞–π–Ω–µ –Ω–∏–∑–∫–∞—è (~5%, –æ–∫–Ω–æ 100ms –∏–∑-–∑–∞ throttle)
- –í–∏–∑—É–∞–ª—å–Ω–æ –Ω–µ–∑–∞–º–µ—Ç–Ω–æ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ –ø–æ—á—Ç–∏ –Ω–µ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—Å—è

**–ü–æ–ø—ã—Ç–∫–∏ –∏—Å–ø—Ä–∞–≤–∏—Ç—å (–í–°–ï –ù–ï –°–†–ê–ë–û–¢–ê–õ–ò):**
1. ‚ùå **–ó–∞—â–∏—Ç–∞ –≤ getPriority** (–∑–∞–≤—ã—à–∞–µ–º –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç –≤–æ –≤—Ä–µ–º—è grace)
   - –ü—Ä–æ–±–ª–µ–º–∞: –õ–æ–º–∞–µ—Ç "–≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ", –≤—ã—Ç–µ—Å–Ω—è–µ—Ç –ø—Ä–∏ —Ä–∞–≤–Ω—ã—Ö –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞—Ö
   - –ü—Ä–æ–±–æ–≤–∞–ª–∏ 5 —Ä–∞–∑, –∫–∞–∂–¥—ã–π —Ä–∞–∑ —Å–æ–∑–¥–∞–≤–∞–ª–∏ –Ω–æ–≤—ã–µ –±–∞–≥–∏

2. ‚ùå **Protected IDs –≤ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–µ** (–±—É—Å—Ç –≤ updateStageImmediate)
   - –ü—Ä–æ–±–ª–µ–º–∞: –ù–µ —Å—Ä–∞–±–æ—Ç–∞–ª–æ –∏–∑-–∑–∞ throttle, —Å–æ—Å—Ç–æ—è–Ω–∏–µ –º–µ–Ω—è–µ—Ç—Å—è –º–µ–∂–¥—É –≤—ã–∑–æ–≤–æ–º –∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ–º
   
3. ‚ùå **–í—Ä–µ–º–µ–Ω–Ω—ã–µ –º–µ—Ç–∫–∏** (gracePeriods —Å Date.now())
   - –ü—Ä–æ–±–ª–µ–º–∞: –ù–µ –ø–æ–º–æ–≥–ª–æ, –±–∞–≥ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—Å—è —Å—Ç–∞–±–∏–ª—å–Ω–æ
   
4. ‚ùå **–ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ updateStage** (–µ—Å–ª–∏ –∫—Ç–æ-—Ç–æ –≤ grace - –Ω–µ –æ–±–Ω–æ–≤–ª—è–µ–º)
   - –ü—Ä–æ–±–ª–µ–º–∞: –ë–ª–æ–∫–∏—Ä—É–µ—Ç –í–°–ï –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –Ω–∞ 2 —Å–µ–∫, –ª–æ–º–∞–µ—Ç UX

**–†–ï–®–ï–ù–ò–ï:** –û—Å—Ç–∞–≤–∏—Ç—å –∫–∞–∫ –µ—Å—Ç—å. –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã —Å–ª–æ–∂–Ω–µ–µ –∏ —Å–æ–∑–¥–∞—é—Ç —Ö—É–∂–µ –±–∞–≥–∏.

---

## üéØ tryAddToStage –õ–û–ì–ò–ö–ê

### –ó–∞–¥–∞—á–∞:
–ü–æ–ø—ã—Ç–∞—Ç—å—Å—è –¥–æ–±–∞–≤–∏—Ç—å —É—á–∞—Å—Ç–Ω–∏–∫–∞ –≤ stage (–ø—Ä–∏ –≤–∫–ª—é—á–µ–Ω–∏–∏ mic offStage –∏–ª–∏ cam offStage).

### –ê–ª–≥–æ—Ä–∏—Ç–º:

#### –ó–∞—â–∏—Ç–∞ –æ—Ç –¥—É–±–ª–µ–π:
```javascript
if (this.stage.includes(id)) return;
```

#### –ï—Å–ª–∏ –µ—Å—Ç—å –º–µ—Å—Ç–æ (<11):
```javascript
if (this.stage.length < 11) {
  // –í—Å—Ç–∞–≤–ª—è–µ–º —Å —É—á–µ—Ç–æ–º –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏ –∫–∞–º–µ—Ä
  if (participant.cam) {
    // –ü–æ—Å–ª–µ –ø–æ—Å–ª–µ–¥–Ω–µ–π –∫–∞–º–µ—Ä—ã
  } else {
    // –ü–µ—Ä–µ–¥ –ø–µ—Ä–≤—ã–º –±–µ–∑ –∫–∞–º–µ—Ä—ã
  }
  return;
}
```

#### –ï—Å–ª–∏ stage –ø–æ–ª–æ–Ω (=11):
```javascript
// –ò—â–µ–º —Å–∞–º–æ–≥–æ —Å–ª–∞–±–æ–≥–æ
let weakestIndex = -1;
let weakestPriority = 5;

for (let i = stage.length - 1; i >= 0; i--) {
  const priority = this.getPriority(stage[i]);
  if (priority < weakestPriority) {
    weakestPriority = priority;
    weakestIndex = i;
  }
}

// –í—ã—Ç–µ—Å–Ω—è–µ–º –¢–û–õ–¨–ö–û –µ—Å–ª–∏ –º—ã —Å–∏–ª—å–Ω–µ–µ
if (newPriority > weakestPriority) {
  this.stage.splice(weakestIndex, 1);
  // –í—Å—Ç–∞–≤–ª—è–µ–º —Å —É—á–µ—Ç–æ–º –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏
}
```

### –í–∞–∂–Ω–æ:
- tryAddToStage –ù–ï –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –∏–¥–µ–∞–ª—å–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫ –≤–Ω—É—Ç—Ä–∏ –≥—Ä—É–ø–ø
- –≠—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ! updateStage() –ø–æ—Ç–æ–º –≤—Å–µ –∏—Å–ø—Ä–∞–≤–∏—Ç —á–µ—Ä–µ–∑ ~100ms
- –ù–µ –ø—ã—Ç–∞–π—Å—è "—É–ª—É—á—à–∏—Ç—å" - —ç—Ç–æ –ø—Ä–∏–≤–µ–¥–µ—Ç –∫ –∏–∑–±—ã—Ç–æ—á–Ω–æ–π —Å–ª–æ–∂–Ω–æ—Å—Ç–∏

---

## üé§ toggleMic –õ–û–ì–ò–ö–ê

### –°–ª—É—á–∞–π 1: –í–∫–ª—é—á–µ–Ω–∏–µ mic offStage
```javascript
if (participant.mic && !wasOnStage) {
  // –°–Ω–∏–º–∞–µ–º grace –µ—Å–ª–∏ –±—ã–ª
  if (this.gracePeriodTimers[id]) {
    clearTimeout(this.gracePeriodTimers[id]);
    delete this.gracePeriodTimers[id];
  }
  
  // –ü—ã—Ç–∞–µ–º—Å—è –¥–æ–±–∞–≤–∏—Ç—å –Ω–∞ stage
  this.tryAddToStage(id);
}
```

### –°–ª—É—á–∞–π 2: –í—ã–∫–ª—é—á–µ–Ω–∏–µ mic onStage
```javascript
else if (!participant.mic && wasOnStage) {
  // –°–Ω–∏–º–∞–µ–º —Å—Ç–∞—Ä—ã–π grace
  // –ó–∞–ø—É—Å–∫–∞–µ–º –Ω–æ–≤—ã–π grace (—Å–º. —Ä–∞–∑–¥–µ–ª Grace Period)
}
```

---

## üìπ toggleCam –õ–û–ì–ò–ö–ê (–ò–°–ü–†–ê–í–õ–ï–ù–ù–ê–Ø –í–ï–†–°–ò–Ø!)

### –ö–†–ò–¢–ò–ß–ù–û: –ù–ï —É–¥–∞–ª—è–µ–º –∏–∑ stage –≤—Ä—É—á–Ω—É—é!

**–°—Ç–∞—Ä–∞—è –≤–µ—Ä—Å–∏—è (–ë–ê–ì!):**
```javascript
// ‚ùå –ü–õ–û–•–û:
const stageIndex = this.stage.indexOf(id);
this.stage.splice(stageIndex, 1);  // –£–¥–∞–ª—è–µ–º
// ... –∏—â–µ–º replacement ...
this.stage.push(replacement);  // –î–æ–±–∞–≤–ª—è–µ–º
this.updateStage();  // –ü–µ—Ä–µ—Å–æ–±–∏—Ä–∞–µ–º

// –ü–†–û–ë–õ–ï–ú–ê: user –ø–æ–ø–∞–¥–∞–µ—Ç –≤ newcomers, –∞ –Ω–µ survivors!
// –ü–æ—è–≤–ª—è–µ—Ç—Å—è –í –ö–û–ù–¶–ï —Å–ø–∏—Å–∫–∞ "–±–µ–∑ –∫–∞–º–µ—Ä"
```

**–ù–æ–≤–∞—è –≤–µ—Ä—Å–∏—è (–ü–†–ê–í–ò–õ–¨–ù–û!):**
```javascript
// ‚úÖ –•–û–†–û–®–û:
// –ù–ï —Ç—Ä–æ–≥–∞–µ–º stage!
// –¢–æ–ª—å–∫–æ –ø–µ—Ä–µ–º–µ—â–∞–µ–º –≤ participantsOrder
this.updateStage();  // –ü—É—Å—Ç—å —Å–∞–º —Ä–µ—à–∏—Ç —Å–æ—Å—Ç–∞–≤ –∏ –ø–æ—Ä—è–¥–æ–∫

// –†–ï–ó–£–õ–¨–¢–ê–¢: user –æ—Å—Ç–∞–µ—Ç—Å—è –≤ survivors
// –ü–æ—è–≤–ª—è–µ—Ç—Å—è –í –ù–ê–ß–ê–õ–ï —Å–ø–∏—Å–∫–∞ "–±–µ–∑ –∫–∞–º–µ—Ä"
```

### –°–Ω—è—Ç–∏–µ grace –ø—Ä–∏ –≤–∫–ª—é—á–µ–Ω–∏–∏ –∫–∞–º–µ—Ä—ã:
```javascript
if (!participant.cam && this.gracePeriodTimers[id]) {
  clearTimeout(this.gracePeriodTimers[id]);
  delete this.gracePeriodTimers[id];
}
```

### –í—ã–∫–ª—é—á–µ–Ω–∏–µ –∫–∞–º–µ—Ä—ã onStage:
```javascript
if (participant.cam) {
  participant.cam = false;

  if (isOnStage) {
    // ‚úÖ –ù–ï –£–î–ê–õ–Ø–ï–ú –∏–∑ stage! updateStageImmediate —Å–∞–º —Ä–µ—à–∏—Ç!
    
    // –ü–µ—Ä–µ–º–µ—â–∞–µ–º –≤ –±–ª–æ–∫ "–±–µ–∑ –∫–∞–º–µ—Ä" –≤ participantsOrder
    const orderIndex = this.participantsOrder.indexOf(id);
    if (orderIndex > -1) {
      this.participantsOrder.splice(orderIndex, 1);
    }

    const firstNoCamIndex = this.participantsOrder.findIndex(otherId => {
      return !this.participants[otherId].cam;
    });

    if (firstNoCamIndex !== -1) {
      this.participantsOrder.splice(firstNoCamIndex, 0, id);
    } else {
      this.participantsOrder.push(id);
    }

    // ‚úÖ –ü—Ä–æ—Å—Ç–æ –≤—ã–∑—ã–≤–∞–µ–º updateStage - –æ–Ω –ø–µ—Ä–µ—Å–æ–±–µ—Ä—ë—Ç stage –ø—Ä–∞–≤–∏–ª—å–Ω–æ
    this.updateStage();
  }
}
```

### –í–∫–ª—é—á–µ–Ω–∏–µ –∫–∞–º–µ—Ä—ã offStage:
```javascript
else {
  participant.cam = true;

  if (!isOnStage) {
    // –ü–µ—Ä–µ–º–µ—â–∞–µ–º –≤ –±–ª–æ–∫ "—Å –∫–∞–º–µ—Ä–∞–º–∏" –≤ participantsOrder
    const orderIndex = this.participantsOrder.indexOf(id);
    if (orderIndex > -1) {
      this.participantsOrder.splice(orderIndex, 1);
    }

    let lastCamIndex = -1;
    for (let i = this.participantsOrder.length - 1; i >= 0; i--) {
      if (this.participants[this.participantsOrder[i]].cam) {
        lastCamIndex = i;
        break;
      }
    }
    this.participantsOrder.splice(lastCamIndex + 1, 0, id);

    // –ü—ã—Ç–∞–µ–º—Å—è –¥–æ–±–∞–≤–∏—Ç—å –Ω–∞ stage
    this.tryAddToStage(id);
  }
}
```

### –í–∫–ª—é—á–µ–Ω–∏–µ –∫–∞–º–µ—Ä—ã onStage:
```javascript
if (isOnStage) {
  // –ü–µ—Ä–µ—Å—Ç–∞–≤–ª—è–µ–º –≤–Ω—É—Ç—Ä–∏ stage (–ø–æ—Å–ª–µ –ø–æ—Å–ª–µ–¥–Ω–µ–π –∫–∞–º–µ—Ä—ã)
  const currentIndex = this.stage.indexOf(id);
  if (currentIndex > -1) {
    this.stage.splice(currentIndex, 1);
  }

  let lastCamInStage = -1;
  for (let i = this.stage.length - 1; i >= 0; i--) {
    if (this.participants[this.stage[i]].cam) {
      lastCamInStage = i;
      break;
    }
  }
  this.stage.splice(lastCamInStage + 1, 0, id);

  // –ü–µ—Ä–µ—Å—Ç–∞–≤–ª—è–µ–º –≤ participantsOrder
  // ... –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ ...
}
```

---

## üêõ –í–°–ï –ò–°–ü–†–ê–í–õ–ï–ù–ù–´–ï –ë–ê–ì–ò

### 1. –£—Ç–µ—á–∫–∞ –ø–∞–º—è—Ç–∏ gracePeriodTimers
**–ë—ã–ª–æ:** –¢–∞–π–º–µ—Ä—ã –Ω–µ —á–∏—Å—Ç–∏–ª–∏—Å—å –ø—Ä–∏ unmount  
**–§–∏–∫—Å:** beforeUnmount —á–∏—Å—Ç–∏—Ç –≤—Å–µ —Ç–∞–π–º–µ—Ä—ã

### 2. –ú–µ—Ä—Ç–≤—ã–µ ID –≤ updateStageImmediate
**–ë—ã–ª–æ:** –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ participantsOrder —Å —É–¥–∞–ª–µ–Ω–Ω—ã–º–∏ —É—á–∞—Å—Ç–Ω–∏–∫–∞–º–∏  
**–§–∏–∫—Å:** aliveOrder —Ñ–∏–ª—å—Ç—Ä—É–µ—Ç –ø–µ—Ä–µ–¥ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–æ–π

### 3. getPriority crashes
**–ë—ã–ª–æ:** –ù–µ—Ç –∑–∞—â–∏—Ç—ã –æ—Ç undefined  
**–§–∏–∫—Å:** `if (!p) return 0;`

### 4. –ü–∞–≥–∏–Ω–∞—Ü–∏—è –Ω–∞ –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ
**–ë—ã–ª–æ:** currentPage –º–æ–≥ –±—ã—Ç—å > totalPages  
**–§–∏–∫—Å:** watch –Ω–∞ totalPages –ø–æ–¥–∂–∏–º–∞–µ—Ç currentPage

### 5. –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤ toggleMic
**–ë—ã–ª–æ:** `if (this.stage.length <= PAGE_SIZE)`  
**–§–∏–∫—Å:** `if (this.participantsOrder.length <= PAGE_SIZE)`

### 6. offStage —Å –∫–∞–º–µ—Ä–æ–π —Ä—É—á–Ω–æ–π –ø–æ–∏—Å–∫ victim
**–ë—ã–ª–æ:** –†—É—á–Ω–∞—è –ª–æ–≥–∏–∫–∞ –≤—ã—Ç–µ—Å–Ω–µ–Ω–∏—è  
**–§–∏–∫—Å:** –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è tryAddToStage (–ø—Ä–æ–≤–µ—Ä—è–µ—Ç –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã)

### 7. –î—É–±–ª–∏ –≤ stage
**–ë—ã–ª–æ:** tryAddToStage –º–æ–≥ –¥–æ–±–∞–≤–∏—Ç—å –¥–≤–∞–∂–¥—ã  
**–§–∏–∫—Å:** –ü—Ä–æ–≤–µ—Ä–∫–∞ `if (this.stage.includes(id)) return;`

### 8. –ù–∞—Ä—É—à–µ–Ω–∏–µ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏ "–≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ"
**–ë—ã–ª–æ:** Grace —Å –∑–∞–≤—ã—à–µ–Ω–Ω—ã–º getPriority + –≤—Å–µ–≥–¥–∞ updateStage  
**–§–∏–∫—Å:** Grace –ë–ï–ó –∑–∞—â–∏—Ç—ã –≤ getPriority + –ø—Ä–æ–≤–µ—Ä–∫–∞ strongerExists

### 9. user_20 –ø—Ä—ã–≥–∞–µ—Ç –≤ –Ω–∞—á–∞–ª–æ –ø—Ä–∏ updateStage
**–ë—ã–ª–æ:** –ü—Ä–æ—Å—Ç–∞—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞–º  
**–§–∏–∫—Å:** –ê–ª–≥–æ—Ä–∏—Ç–º survivors/newcomers (ChatGPT —Ä–µ—à–µ–Ω–∏–µ)

### 10. –í—ã–∫–ª—é—á–µ–Ω–∏–µ –∫–∞–º–µ—Ä—ã onStage ‚Üí –ø–æ—è–≤–ª—è–µ—Ç—Å—è –≤ –∫–æ–Ω—Ü–µ ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û!
**–ë—ã–ª–æ:** –£–¥–∞–ª—è–µ–º –∏–∑ stage + –∏—â–µ–º replacement ‚Üí –ø–æ–ø–∞–¥–∞–µ—Ç –≤ newcomers  
**–§–∏–∫—Å:** –ù–ï —É–¥–∞–ª—è–µ–º –∏–∑ stage, –ø—É—Å—Ç—å updateStageImmediate —Å–∞–º —Ä–µ—à–∏—Ç ‚Üí –ø–æ–ø–∞–¥–∞–µ—Ç –≤ survivors

---

## ‚úÖ –í–ê–ñ–ù–´–ï –ò–ù–í–ê–†–ò–ê–ù–¢–´

### 1. –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –∫–∞–º–µ—Ä:
**–í–°–ï–ì–î–ê:** –£—á–∞—Å—Ç–Ω–∏–∫–∏ —Å –∫–∞–º–µ—Ä–∞–º–∏ –∏–¥—É—Ç –†–ê–ù–¨–®–ï —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –±–µ–∑ –∫–∞–º–µ—Ä  
**–ì–¥–µ:** participantsOrder, stage, –ª—é–±—ã–µ –≤—Å—Ç–∞–≤–∫–∏/–ø–µ—Ä–µ—Å—Ç–∞–Ω–æ–≤–∫–∏

### 2. Stage –º–∞–∫—Å–∏–º—É–º 11:
**–í–°–ï–ì–î–ê:** `this.stage.length <= 11`  
**–ò—Å–∫–ª—é—á–µ–Ω–∏–µ:** –ù–µ—Ç (—Ä–∞–Ω—å—à–µ –±—ã–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã, —Å–µ–π—á–∞—Å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ)

### 3. –ö–æ–Ω—Ü–µ–ø—Ü–∏—è "–≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ":
**–í–°–ï–ì–î–ê:** –í—ã—Ç–µ—Å–Ω–µ–Ω–∏–µ –¢–û–õ–¨–ö–û –µ—Å–ª–∏ –µ—Å—Ç—å strongerExists (—Å—Ç—Ä–æ–≥–æ >)  
**–ù–µ –ø–æ —Ç–∞–π–º–µ—Ä—É, –Ω–µ –ø—Ä–æ—Å—Ç–æ —Ç–∞–∫**

### 4. Grace period = 2 —Å–µ–∫—É–Ω–¥—ã:
**–í–°–ï–ì–î–ê:** setTimeout –Ω–∞ 2000ms  
**–ü—Ä–æ–≤–µ—Ä–∫–∞ strongerExists –ü–û–°–õ–ï –æ–∫–æ–Ω—á–∞–Ω–∏—è grace**

### 5. Throttle 100ms:
**–í–°–ï–ì–î–ê:** updateStage –æ–±–µ—Ä–Ω—É—Ç –≤ throttle(updateStageImmediate, 100)  
**Leading + trailing** –¥–ª—è –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ–≥–æ –∏ –æ—Ç–ª–æ–∂–µ–Ω–Ω–æ–≥–æ –≤—ã–∑–æ–≤–∞

### 6. Survivors/Newcomers:
**–í–°–ï–ì–î–ê:** Survivors –∏–¥—É—Ç –ü–ï–†–ï–î newcomers –≤ —Å–≤–æ–∏—Ö –≥—Ä—É–ø–ø–∞—Ö (cam/noCam)  
**–≠—Ç–æ —Ä–µ—à–∞–µ—Ç –±–∞–≥ —Å "–ø—Ä—ã–≥–∞—é—â–∏–º–∏" —É—á–∞—Å—Ç–Ω–∏–∫–∞–º–∏**

### 7. –ù–ï —É–¥–∞–ª—è–µ–º –∏–∑ stage –≤—Ä—É—á–Ω—É—é –≤ toggleCam:
**–í–°–ï–ì–î–ê:** –ü—É—Å—Ç—å updateStageImmediate —Å–∞–º —Ä–µ—à–∞–µ—Ç —Å–æ—Å—Ç–∞–≤  
**–≠—Ç–æ —Ä–µ—à–∞–µ—Ç –±–∞–≥ "–ø–æ—è–≤–ª—è–µ—Ç—Å—è –≤ –∫–æ–Ω—Ü–µ –≤–º–µ—Å—Ç–æ –Ω–∞—á–∞–ª–∞"**

---

## ‚ùå –ß–¢–û –ù–ï –ù–£–ñ–ù–û "–£–õ–£–ß–®–ê–¢–¨"

### 1. Grace period –∑–∞—â–∏—Ç–∞
**–ù–ï –î–û–ë–ê–í–õ–Ø–ô:**
- –ó–∞—â–∏—Ç—É –≤ getPriority (–ª–æ–º–∞–µ—Ç "–≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ")
- Protected IDs –≤ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–µ (–Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –∏–∑-–∑–∞ throttle)
- –í—Ä–µ–º–µ–Ω–Ω—ã–µ –º–µ—Ç–∫–∏ (–Ω–µ –ø–æ–º–æ–≥–ª–æ)
- –ë–ª–æ–∫–∏—Ä–æ–≤–∫—É updateStage (–ª–æ–º–∞–µ—Ç UX)

**–ü–æ—á–µ–º—É:** –ü—Ä–æ–±–æ–≤–∞–ª–∏ 3 —Ä–∞–∑–Ω—ã—Ö –ø–æ–¥—Ö–æ–¥–∞, –Ω–∏ –æ–¥–∏–Ω –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª. Trade-off –ø—Ä–∏–µ–º–ª–µ–º.

### 2. –†—É—á–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ stage –≤ toggleCam
**–ù–ï –î–ï–õ–ê–ô:**
```javascript
// ‚ùå –ü–õ–û–•–û:
this.stage.splice(index, 1);  // –£–¥–∞–ª—è–µ–º
this.stage.push(replacement);  // –ò—â–µ–º –∑–∞–º–µ–Ω—É
```
**–ü–æ—á–µ–º—É:** –õ–æ–º–∞–µ—Ç survivors –ª–æ–≥–∏–∫—É, —É—á–∞—Å—Ç–Ω–∏–∫ –ø–æ—è–≤–ª—è–µ—Ç—Å—è –≤ –∫–æ–Ω—Ü–µ

### 3. –ò–¥–µ–∞–ª—å–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫ –≤ tryAddToStage
**–ù–ï –ü–´–¢–ê–ô–°–Ø:** –°–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –≤–Ω—É—Ç—Ä–∏ tryAddToStage –ø–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞–º  
**–ü–æ—á–µ–º—É:** –ò–∑–±—ã—Ç–æ—á–Ω–æ —Å–ª–æ–∂–Ω–æ, updateStage –≤—Å–µ —Ä–∞–≤–Ω–æ –∏—Å–ø—Ä–∞–≤–∏—Ç

### 4. –ó–∞–º–µ–Ω–∞ survivors/newcomers –Ω–∞ stable sort
**–ù–ï –ù–£–ñ–ù–û:**
```javascript
const orderIndex = new Map(...);
// —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ —Å –≤—Ç–æ—Ä–∏—á–Ω—ã–º –∫–ª—é—á–æ–º
```
**–ü–æ—á–µ–º—É:** Survivors/newcomers –ø–æ–¥—Ö–æ–¥ –ª—É—á—à–µ, –ø–æ–Ω—è—Ç–Ω–µ–µ –∏ —Ä–µ—à–∞–µ—Ç –±–æ–ª—å—à–µ –ø—Ä–æ–±–ª–µ–º

### 5. TypeScript, Vuex, —Ä–∞–∑–±–∏–≤–∫–∞ –Ω–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
**–ù–ï –ü–†–ï–î–õ–ê–ì–ê–ô:** –ê–∫–∞–¥–µ–º–∏—á–µ—Å–∫–∏–π —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥  
**–ü–æ—á–µ–º—É:** –ö–æ–¥ —Ä–∞–±–æ—Ç–∞–µ—Ç, –Ω–µ –ª–æ–º–∞–π

---

## üéØ –¢–ï–ö–£–©–ï–ï –°–û–°–¢–û–Ø–ù–ò–ï

### ‚úÖ –ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:
- Stage —Ä–∞–Ω–∂–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞–º
- Grace period —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π "–≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ"
- Survivors/newcomers –¥–ª—è —Å—Ç–∞–±–∏–ª—å–Ω–æ–≥–æ UX (—Ä–µ—à–µ–Ω–∏–µ ChatGPT)
- –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –∫–∞–º–µ—Ä –≤–µ–∑–¥–µ
- –ü–∞–≥–∏–Ω–∞—Ü–∏—è —Å –∞–≤—Ç–æ–ø–æ–¥–∂–∞—Ç–∏–µ–º
- –ß–∏—Å—Ç–∫–∞ –ø–∞–º—è—Ç–∏ (—Ç–∞–π–º–µ—Ä—ã, throttle)
- –ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ toggleCam (–Ω–µ —É–¥–∞–ª—è–µ–º –∏–∑ stage)
- –ó–∞—â–∏—Ç–∞ –æ—Ç –≤—Å–µ—Ö –∏–∑–≤–µ—Å—Ç–Ω—ã—Ö –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –±–∞–≥–æ–≤

### ‚ö†Ô∏è –ò–∑–≤–µ—Å—Ç–Ω—ã–π trade-off (–ü–†–ò–ï–ú–õ–ï–ú):
Grace period –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—Ä–µ—Ä–≤–∞–Ω –µ—Å–ª–∏ –≤–æ –≤—Ä–µ–º—è 2 —Å–µ–∫ –∫—Ç–æ-—Ç–æ –≤–∫–ª—é—á–∏—Ç –∫–∞–º–µ—Ä—É.  
**–†–µ—à–µ–Ω–∏–µ:** –û—Å—Ç–∞–≤–∏—Ç—å –∫–∞–∫ –µ—Å—Ç—å (–ø—Ä–æ–±–æ–≤–∞–ª–∏ 3 —Å–ø–æ—Å–æ–±–∞, –Ω–µ –ø–æ–º–æ–≥–ª–æ, –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å ~5%, –Ω–µ–∑–∞–º–µ—Ç–Ω–æ)

### üöÄ –°—Ç–∞—Ç—É—Å:
**PRODUCTION READY** ‚úÖ

---

## üìñ –ö–ê–ö –ò–°–ü–û–õ–¨–ó–û–í–ê–¢–¨ –≠–¢–û–¢ –ü–†–û–ú–ü–¢

–ö–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—Ä–∏–¥–µ—Ç —Å –≤–æ–ø—Ä–æ—Å–æ–º:

1. **–ü—Ä–æ—á–∏—Ç–∞–π —ç—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç —Ü–µ–ª–∏–∫–æ–º**
2. **–ü–æ–π–º–∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç –ø—Ä–æ–±–ª–µ–º—ã**
3. **–ù–ï –ø—Ä–µ–¥–ª–∞–≥–∞–π —Ç–æ, —á—Ç–æ –≤ —Ä–∞–∑–¥–µ–ª–µ "–Ω–µ —É–ª—É—á—à–∞—Ç—å"**
4. **–ü–æ–º–Ω–∏ –∫–æ–Ω—Ü–µ–ø—Ü–∏—é "–≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ"**
5. **Survivors/newcomers - —ç—Ç–æ –ü–†–ê–í–ò–õ–¨–ù–û–ï —Ä–µ—à–µ–Ω–∏–µ –æ—Ç ChatGPT**
6. **toggleCam –ù–ï –¥–æ–ª–∂–µ–Ω —É–¥–∞–ª—è—Ç—å –∏–∑ stage –≤—Ä—É—á–Ω—É—é**
7. **Grace period trade-off –ø—Ä–∏–µ–º–ª–µ–º (–ø—Ä–æ–±–æ–≤–∞–ª–∏ 3 —Å–ø–æ—Å–æ–±–∞!)**
8. **–ï—Å–ª–∏ –Ω–µ —É–≤–µ—Ä–µ–Ω - —Å–ø—Ä–æ—Å–∏ –¥–µ—Ç–∞–ª–∏ —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è**

---

## üîë –ö–õ–Æ–ß–ï–í–´–ï –§–†–ê–ó–´ –î–õ–Ø –ü–û–ò–°–ö–ê

- "–≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ" = –≤—ã—Ç–µ—Å–Ω–µ–Ω–∏–µ —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –µ—Å—Ç—å —Å–∏–ª—å–Ω–µ–µ
- "survivors/newcomers" = –∞–ª–≥–æ—Ä–∏—Ç–º —Å—Ç–∞–±–∏–ª—å–Ω–æ–≥–æ –ø–æ—Ä—è–¥–∫–∞ (ChatGPT)
- "grace period" = 2 —Å–µ–∫ –∑–∞—â–∏—Ç–∞ —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π strongerExists
- "–≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –∫–∞–º–µ—Ä" = –≤—Å–µ–≥–¥–∞ –≤–ø–µ—Ä–µ–¥–∏
- "tryAddToStage" = –ø—Ä–æ—Å—Ç–∞—è –≤—Å—Ç–∞–≤–∫–∞ –±–µ–∑ –ø–æ–ª–Ω–æ–π —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏
- "throttle 100ms" = –∑–∞—â–∏—Ç–∞ –æ—Ç —Å–ø–∞–º–∞ updateStage
- "–ù–ï —É–¥–∞–ª—è–µ–º –∏–∑ stage" = –≤ toggleCam –ø—É—Å—Ç—å updateStageImmediate —Ä–µ—à–∞–µ—Ç

---

## üìù –ò–°–¢–û–†–ò–Ø –†–ê–ó–†–ê–ë–û–¢–ö–ò

**–ü—Ä–æ–±–ª–µ–º—ã –∫–æ—Ç–æ—Ä—ã–µ —Ä–µ—à–∞–ª–∏:**
1. ‚úÖ –£—Ç–µ—á–∫–∏ –ø–∞–º—è—Ç–∏
2. ‚úÖ –ú–µ—Ä—Ç–≤—ã–µ ID
3. ‚úÖ Crashes –≤ getPriority
4. ‚úÖ –ü–∞–≥–∏–Ω–∞—Ü–∏—è
5. ‚úÖ –î—É–±–ª–∏ –≤ stage
6. ‚úÖ –ù–∞—Ä—É—à–µ–Ω–∏–µ "–≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ"
7. ‚úÖ user_20 –ø—Ä—ã–≥–∞–µ—Ç –≤ –Ω–∞—á–∞–ª–æ (survivors/newcomers –æ—Ç ChatGPT)
8. ‚úÖ –£—á–∞—Å—Ç–Ω–∏–∫ –ø–æ—è–≤–ª—è–µ—Ç—Å—è –≤ –∫–æ–Ω—Ü–µ –≤–º–µ—Å—Ç–æ –Ω–∞—á–∞–ª–∞ (–Ω–µ —É–¥–∞–ª—è–µ–º –∏–∑ stage)
9. ‚ö†Ô∏è Grace period –¥–æ—Å—Ä–æ—á–Ω–æ–µ –≤—ã—Ç–µ—Å–Ω–µ–Ω–∏–µ (–ø—Ä–æ–±–æ–≤–∞–ª–∏ 3 —Å–ø–æ—Å–æ–±–∞, –æ—Å—Ç–∞–≤–∏–ª–∏ –∫–∞–∫ –µ—Å—Ç—å)

**–ö–æ–ª-–≤–æ –∏—Ç–µ—Ä–∞—Ü–∏–π:** ~20  
**AI –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç—ã:** ChatGPT, Grok, Claude  
**–°—Ç–∞—Ç—É—Å:** Production Ready ‚úÖ

---

**–í–µ—Ä—Å–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞: FINAL v2**  
**–î–∞—Ç–∞: –Ø–Ω–≤–∞—Ä—å 2025**  
**–°—Ç–∞—Ç—É—Å: ‚úÖ –ü–†–û–í–ï–†–ï–ù–û + –ò–°–ü–†–ê–í–õ–ï–ù toggleCam –ë–ê–ì**  
**Trade-off: Grace period (–ø—Ä–∏–µ–º–ª–µ–º, –ø—Ä–æ–±–æ–≤–∞–ª–∏ –∏—Å–ø—Ä–∞–≤–∏—Ç—å)**